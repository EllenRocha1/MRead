<%# app/views/books/_search_results.html.erb %>
<%= turbo_frame_tag "results_frame" do %>
  <div class="list-group search-results-list">
    <% if results.any? %>
      <% results.each do |book| %>
        <div class="list-group-item search-result-item d-flex align-items-center justify-content-between p-3">
          
          <div class="d-flex align-items-center">
            <% if book[:cover_url].present? %>
              <%= image_tag book[:cover_url], class: "search-result-thumb shadow-sm" %>
            <% else %>
              <div class="search-result-placeholder d-flex align-items-center justify-content-center">N/A</div>
            <% end %>
            
            <%# Mudamos de ID para CLASSE para evitar duplicatas no DOM %>
            <div class="search-result-info">
              <h6 class="mb-0 search-result-title"><%= book[:title] %></h6>
              <small class="search-result-author">
                <%= book[:author] %> | <%= book[:publish_year] %>
              </small>
            </div>
          </div>

          <%# Persistência: Este formulário garante que o clique salve os dados no SQLite via Docker %>
          <%= form_with model: Book.new, url: books_path, local: true, data: { turbo: false } do |f| %>
            <%= f.hidden_field :title, value: book[:title] %>
            <%= f.hidden_field :author, value: book[:author] %>
            <%= f.hidden_field :publish_year, value: book[:publish_year] %>
            <%= f.hidden_field :isbn, value: book[:isbn] %>
            <%= f.hidden_field :image_url, value: book[:cover_url] %>
            <%= f.hidden_field :status, value: "Para ler" %>
            
            <%# Usamos a classe .btn-coffee para remover o último estilo inline %>
            <%= f.submit "Selecionar", class: "btn btn-sm btn-coffee" %>
          <% end %>

        </div>
      <% end %>
    <% else %>
      <div class="alert alert-warning m-2 bg-dark text-warning border-warning">
        Nenhum livro encontrado para essa busca no acervo.
      </div>
    <% end %>
  </div>
<% end %>